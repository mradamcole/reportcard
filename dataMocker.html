<html>

<head>
    <script>
        //Seed data and data formatting functions
        const fakeNames = {
            "person": [
                {
                    "name": "Sandy",
                    "surname": "Jenkins"
                },
                {
                    "name": "Vanessa",
                    "surname": "Puckett"
                },
                {
                    "name": "Ricky",
                    "surname": "Freedman"
                },
                {
                    "name": "Barry",
                    "surname": "Bowling"
                },
                {
                    "name": "Leo",
                    "surname": "Hewitt"
                },
                {
                    "name": "Florence",
                    "surname": "Waters"
                },
                {
                    "name": "Mary",
                    "surname": "Dunlap"
                },
                {
                    "name": "Ross",
                    "surname": "Dillon"
                },
                {
                    "name": "Bob",
                    "surname": "Rowland"
                },
                {
                    "name": "Rhonda",
                    "surname": "Graham"
                },
                {
                    "name": "Sherri",
                    "surname": "Stanley"
                },
                {
                    "name": "Steve",
                    "surname": "Gilbert"
                },
                {
                    "name": "Tom",
                    "surname": "Chang"
                },
                {
                    "name": "Glenda",
                    "surname": "Sawyer"
                },
                {
                    "name": "Allen",
                    "surname": "Cash"
                },
                {
                    "name": "Gilbert",
                    "surname": "Waller"
                },
                {
                    "name": "Bonnie",
                    "surname": "Desai"
                },
                {
                    "name": "Shannon",
                    "surname": "Cates"
                },
                {
                    "name": "Charlotte",
                    "surname": "Aldridge"
                },
                {
                    "name": "Bob",
                    "surname": "Monroe"
                },
                {
                    "name": "Jordan",
                    "surname": "Hawkins"
                },
                {
                    "name": "Ashley",
                    "surname": "Bolton"
                },
                {
                    "name": "Caroline",
                    "surname": "Carroll"
                },
                {
                    "name": "Randall",
                    "surname": "Anderson"
                },
                {
                    "name": "Gregory",
                    "surname": "Raynor"
                },
                {
                    "name": "Calvin",
                    "surname": "Brennan"
                },
                {
                    "name": "Jerome",
                    "surname": "Graves"
                },
                {
                    "name": "Jack",
                    "surname": "Love"
                },
                {
                    "name": "Hannah",
                    "surname": "Abrams"
                },
                {
                    "name": "Brooke",
                    "surname": "Waller"
                },
                {
                    "name": "Martha",
                    "surname": "Justice"
                },
                {
                    "name": "Dan",
                    "surname": "Harrell"
                },
                {
                    "name": "Glen",
                    "surname": "Blanchard"
                },
                {
                    "name": "Karen",
                    "surname": "Gray"
                },
                {
                    "name": "Harvey",
                    "surname": "Gibson"
                },
                {
                    "name": "Vivian",
                    "surname": "Blair"
                },
                {
                    "name": "Jon",
                    "surname": "Ford"
                },
                {
                    "name": "Martin",
                    "surname": "Coates"
                },
                {
                    "name": "Gretchen",
                    "surname": "Pitts"
                },
                {
                    "name": "Kelly",
                    "surname": "Clements"
                },
                {
                    "name": "Calvin",
                    "surname": "Lowry"
                },
                {
                    "name": "Wesley",
                    "surname": "Richmond"
                },
                {
                    "name": "Martha",
                    "surname": "Norman"
                },
                {
                    "name": "Guy",
                    "surname": "Scarborough"
                },
                {
                    "name": "Hannah",
                    "surname": "Katz"
                },
                {
                    "name": "Beth",
                    "surname": "McGuire"
                },
                {
                    "name": "Danny",
                    "surname": "Barton"
                },
                {
                    "name": "Gina",
                    "surname": "Burgess"
                },
                {
                    "name": "Vivian",
                    "surname": "Hardison"
                },
                {
                    "name": "Walter",
                    "surname": "Lin"
                },
                {
                    "name": "Stephen",
                    "surname": "McNamara"
                },
                {
                    "name": "Barbara",
                    "surname": "Roth"
                },
                {
                    "name": "Glenn",
                    "surname": "Lawrence"
                },
                {
                    "name": "Clifford",
                    "surname": "Nance"
                },
                {
                    "name": "Wesley",
                    "surname": "Haynes"
                },
                {
                    "name": "Scott",
                    "surname": "Holland"
                },
                {
                    "name": "Erica",
                    "surname": "Horowitz"
                },
                {
                    "name": "Regina",
                    "surname": "Hensley"
                },
                {
                    "name": "Gloria",
                    "surname": "Hendrix"
                },
                {
                    "name": "Mike",
                    "surname": "Jernigan"
                },
                {
                    "name": "Dan",
                    "surname": "Bowles"
                },
                {
                    "name": "Lloyd",
                    "surname": "Owen"
                },
                {
                    "name": "Nathan",
                    "surname": "Vaughn"
                },
                {
                    "name": "Jeff",
                    "surname": "Hu"
                },
                {
                    "name": "Jordan",
                    "surname": "Marsh"
                },
                {
                    "name": "Gilbert",
                    "surname": "Stephens"
                },
                {
                    "name": "Martha",
                    "surname": "Robinson"
                },
                {
                    "name": "Brooke",
                    "surname": "Scarborough"
                },
                {
                    "name": "Caroline",
                    "surname": "Wagner"
                },
                {
                    "name": "Dennis",
                    "surname": "Becker"
                },
                {
                    "name": "Gene",
                    "surname": "Conway"
                },
                {
                    "name": "Molly",
                    "surname": "Petersen"
                },
                {
                    "name": "Jerry",
                    "surname": "Casey"
                },
                {
                    "name": "Jacob",
                    "surname": "Summers"
                },
                {
                    "name": "Tamara",
                    "surname": "Connor"
                },
                {
                    "name": "Erin",
                    "surname": "Nichols"
                },
                {
                    "name": "Michelle",
                    "surname": "Dunn"
                },
                {
                    "name": "Cynthia",
                    "surname": "Sutherland"
                },
                {
                    "name": "Brian",
                    "surname": "Burton"
                },
                {
                    "name": "Melanie",
                    "surname": "Reed"
                },
                {
                    "name": "Audrey",
                    "surname": "Bray"
                },
                {
                    "name": "Carrie",
                    "surname": "Davis"
                },
                {
                    "name": "Alex",
                    "surname": "Duke"
                },
                {
                    "name": "Lester",
                    "surname": "Sawyer"
                },
                {
                    "name": "Kyle",
                    "surname": "Barbour"
                },
                {
                    "name": "Kate",
                    "surname": "Kent"
                },
                {
                    "name": "Annette",
                    "surname": "Walters"
                },
                {
                    "name": "Geraldine",
                    "surname": "Stephens"
                },
                {
                    "name": "James",
                    "surname": "Hendricks"
                },
                {
                    "name": "Catherine",
                    "surname": "Harrell"
                },
                {
                    "name": "Vernon",
                    "surname": "Davies"
                },
                {
                    "name": "Vivian",
                    "surname": "Davidson"
                },
                {
                    "name": "Glen",
                    "surname": "Kirby"
                },
                {
                    "name": "Steve",
                    "surname": "Coley"
                },
                {
                    "name": "Eugene",
                    "surname": "Parks"
                },
                {
                    "name": "Alan",
                    "surname": "Sanchez"
                },
                {
                    "name": "Eva",
                    "surname": "Murphy"
                },
                {
                    "name": "Regina",
                    "surname": "Anderson"
                },
                {
                    "name": "Johnny",
                    "surname": "Best"
                },
                {
                    "name": "Audrey",
                    "surname": "Maynard"
                }
            ],
            "healthcareEntity": ["Primary care", "Hospital, in-patient", "Hospital, ambulatory", "Urgent care", "Specialty care", "Home care", "Community support services", "Mental health and addiction services", "Health promotion and disease prevention", "Rehabilitation and complex care", "Palliative care", "Residential care", "Long-term care", "Labratory and diagnostic services", "Midwifery services", "Pharmacy", "Other social and community services"],
            "OHT": ["Algoma", "All Nations Health Partners", "Brampton, Etobicoke and Area", "Brantford Brant", "Burlington", "Cambridge North Dumfries", "Chatham-Kent", "Connected Care Halton", "Connected for Care –Lanark, Leeds and Grenville", "Couchiching", "Downtown East Toronto", "Durham", "East Toronto", "Eastern York Region and North Durham", "Frontenac, Lennox & Addington", "Guelph Wellington", "Hamilton", "Hills of Headwaters Collaborative", "Huron Perth and Area", "Kawartha Lakes", "Kitchener, Waterloo, Wilmot, Woolwich, and Wellesley (KW4)", "Mid-West Toronto", "Mississauga", "Muskoka and Area", "Near North Health and Wellness", "Niagara", "North Toronto", "North Western Toronto", "North York Toronto Health Partners", "Northumberland", "Ottawa", "Ottawa East", "Oxford and Area", "Peterborough", "Rainy River District", "Sarnia Lambton", "Scarborough", "South Georgian Bay", "Southlake Community", "West Toronto", "Western York Region", "Western Ontario Health"],
            "err": ["404 Not Found", "407 Proxy Authentication Required", "502 Bad Gateway", "401 Unauthorized", "408 Request Timeout", "414 Request-URI Too Long"],
            "resources": ["Observation", "Encounter", "QuestionnaireResponse", "Claim", "Condition", "MedicationStatement", "Location", "Immunization", "ExplanationOfBenefit", "DiagnosticReport", "Practitioner", "ORganization", "Appointment", "Coverage", "DocumentReference", "MessageHeader", "Slot", "Schedule", "Procedure", "ClaimResponse", "MedicationRequest", "AuditEvent", "PractitionerRole", "Binary", "AllergyIntolerance", "List", "Device", "Medication", "CarePlan", "Bundle", "Provenance", "CareTeam", "ServiceRequest", "HealthcareService", "ImagingStudy", "Specimen", "Goal"]
        }

        // Create a new date from a string, return as a timestamp. yyyy-mm-dd
        function timestamp(str) {
            return new Date(str).getTime();
        }

        // Random number, centred around bias, with attraction to bias, influence [attraction to the bias] (0..1..) [0=no bias, 1=tight peak, b/w 0..1=increasingly narrow plateau vs. shorter peak, >1=increasingly shorter peak]
        function rand(min, max, bias, influence) {
            let rnd = Math.random() * (max - min) + min,      // random in range
                mix = Math.random() * influence;              // random mixer
            let x = Math.floor(rnd * (1 - mix) + bias * mix);  // mix full range and bias
            return (x >= min && x <= max) ? x : rand(min, max, bias, influence);    //because if influence>1 it may return a value outside of min..max
        }

        //test/visualize the random generator
        let randTest = (min, max, bias, influence, iterations) => {
            min = min || 0;
            max = max || 15;
            bias = bias || 0;
            influence = influence || .95;
            iterations = iterations || 10000;
            ar = Array(max).fill(0);
            for (var i = 0; i < iterations; i++) {
                r = rand(min, max, bias, influence);
                ar[r]++;
            }
            s = "";
            for (var i = 0; i < max; i++) {
                s += `<div style="width: ${ar[i]}px; background-color: #ffa060; font-size:12">${i}: ${ar[i]}</div>`;
            }
            document.write(s);
        }
        randTest();

        // Date object to pretty string date.
        var weekdays = ["Sunday", "Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday"];
        var months = ["January", "February", "March", "April", "May", "June", "July", "August", "September", "October", "November", "December"];

        // Append a suffix to dates. Example: 23 => 23rd, 1 => 1st.
        function nth(d) {
            if (d > 3 && d < 21) return 'th';
            switch (d % 10) {
                case 1:
                    return "st";
                case 2:
                    return "nd";
                case 3:
                    return "rd";
                default:
                    return "th";
            }
        }

        // Create a string representation of the date. shorten is optional, if supplied will truncate day of week and month to # of characters
        function formatDate(date, shorten) {
            if (typeof date != "undefined") {
                return weekdays[date.getDay()].substr(0, shorten) + ", " +
                    date.getDate() + nth(date.getDate()) + " " +
                    months[date.getMonth()].substr(0, shorten) + " " +
                    date.getFullYear();
            } else {
                return false;
            }
        }

        //Display the stringifyied JSON
        outputDiv = (content, title) => {
            let s = `</br><span style="font-family: sans-serif; font-size: 18; font-weight: bold;">${title}:</span></br><textarea style="height: 200px; width: 90%;">${JSON.stringify(content)}</textarea>`;
            document.write(s);
        }
    </script>
</head>

<body>
    <script>
        //Create mock data

        //OHT Organizations
        var orgData = [];
        var orgRecords = 100;
        var dateRangeMin = timestamp('2019-01-01');
        var dateRangeMax = timestamp(timestamp(Date.now()));
        for (var i = 0; i < orgRecords; i++) {
            org = fakeNames.OHT[Math.floor(Math.random() * fakeNames.OHT.length)];
            orgType = fakeNames.healthcareEntity[rand(0, fakeNames.healthcareEntity.length, 2, 100)];
            dCreate = rand(dateRangeMin, dateRangeMax, 0, 0);
            dFirst = rand(dCreate, dateRangeMax, 0, 0);
            dMostRecent = rand(dFirst, dateRangeMax, 0, 0);
            patsInRepo = Math.floor(Math.random() * 30000) + 250;
            patsInHP = Math.floor(Math.random() * 30000) + 250;
            submissions = Math.floor(Math.random() * patsInRepo);
            orgData[i] = {
                "id": i,
                "org": org,
                "orgType": orgType,
                "createDate": dCreate,
                "createDateHuman": formatDate(new Date(dCreate)),
                "firstDate": dFirst,
                "firstDateHuman": formatDate(new Date(dFirst)),
                "mostRecentDate": dMostRecent,
                "mostRecentDateHuman": formatDate(new Date(dMostRecent)),
                "patientsInRepo": patsInRepo,
                "patientsInHP": patsInHP,
                "resourcesInRepo": (Math.floor(Math.random() * 30) + 5) * patsInRepo,
                "resourcesInHP": (Math.floor(Math.random() * 30) + 5) * patsInHP,
                "contributionSubmissions": submissions,
                "contributionResubmissions": Math.floor(Math.random() * submissions * 0.5),
                "contribution Failures": Math.floor(Math.random() * submissions * 0.003)
            };
        }
        outputDiv(orgData, "Organizations");

        //Patients
        var patData = [];
        var totalPats = 100;
        for (var i = 0; i < totalPats; i++) {
            OHIP = (Math.floor(Math.random() * 9999) + "-").padStart(5, '0') + (Math.floor(Math.random() * 999) + "-").padStart(4, '0') + (Math.floor(Math.random() * 999) + "").padStart(3, '0');
            l = fakeNames.person[Math.floor(Math.random() * 99)].name;
            f = fakeNames.person[Math.floor(Math.random() * 99)].surname;
            orgs = rand(0, 12, 0, 1);
            orgList = [];
            for (var j = 0; j < orgs; j++) {
                orgList[j] = orgData[Math.floor(Math.random() * orgData.length)].org;
            }
            orgList = [...new Set(orgList)].sort();
            for (var j = 0; j < orgList.length; j++) {
                a = Math.floor(Math.random() * 45) - 15;
                a = a < 0 ? 0 : a;
                b = Math.floor(Math.random() * 45) - 15;
                b = b < 0 ? 0 : b;
                orgList[j] = {
                    "name": orgList[j],
                    "resourcesInRepo": a,
                    "resourcesInHP": b
                };
            }
            patData[i] = {
                "OHIP": OHIP,
                "lastName": l,
                "firstName": f,
                "orgs": orgList
            };
        }
        outputDiv(patData, "Patients");
        // console.log(patData);

        //Queries
        var qryData = [];
        var totalQrys = 100;
        for (var i = 0; i < totalQrys; i++) {
            d = rand(dateRangeMin, dateRangeMax, 0, 0);
            p = Math.floor(Math.random() * patData.length);
            o = patData[p].orgs;
            res = (Math.floor(Math.random() * 10) - 1) < 0 ? 0 : 1;
            res = res == 1 ? "200 Success" : fakeNames.err[Math.floor(Math.random() * fakeNames.err.length)];
            r = 0;
            for (var j = 0; j < o.length; j++) {
                r += o[j].resourcesInRepo + o[j].resourcesInHP;
            }
            resList = [];
            for (var j = 0; j < r; j++) {
                // resList[j] = fakeNames.resources[Math.floor(Math.random() * fakeNames.resources.length)];
                resList[j] = fakeNames.resources[rand(0, fakeNames.resources.length, 0, .95)];
            }
            if (resList.length > 0) { resList[0] = "Patient"; }
            resList = resList.sort();
            // console.log(resList)
            qryData[i] = {
                "id": i,
                "qryDatetime": d,
                "qryDatetimeHuman": new Date(d),
                "patID": patData[p].OHIP,
                "patOrgs": o,
                "hpResponse": res,
                "resList": resList,
                "hpResponseTime": rand(4, 200, 12, 5),
                "requestor": ((Math.floor(Math.random() * 899999999) + 100000000) + "").padStart(9, "0")
            };
        }
        console.log(qryData);
        outputDiv(qryData, "Queries");

    </script>

</body>

</html>